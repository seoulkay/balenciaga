<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>FEEL GOOD</title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.13.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
            <div class="container">
                <a class="navbar-brand js-scroll-trigger" href="#page-top">FEEL GOOD</a>
                <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#about">About</a></li>
                        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#projects">Projects</a></li>
                        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#signup">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Masthead 메인-->
        <header class="masthead" id="header">
            <div class="container d-flex h-100 align-items-center">
                <div class="mx-auto text-center">
                    <h1 class="mx-auto my-0 text-uppercase" id="title1">Cheapest Flight</h1>
                    <h2 class="text-white-50 mx-auto mt-2 mb-5" id="desc1">PREP</h2>
                    <a class="btn btn-primary js-scroll-trigger" href="#about">Get Started</a>
                    <button class="btn btn-primary mx-auto" id="magicButton">Magic Button</button>
                    <button class="btn btn-primary mx-auto" id="noMagicButton">No Magic Button</button>
                </div>
            </div>
        </header>
        <!-- About-->
        <section class="about-section text-center" id="about">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <h2 class="text-white mb-4" id="title2">Back against the wall</h2>
                        <p class="text-white-50" id="desc2">There goes the fllor beneath my feet&nbsp;&nbsp;&nbsp;&nbsp;A stack of empty crates&nbsp;&nbsp;&nbsp;&nbsp;Giving out under me<br>I'll take one more sleeplesee night&nbsp;&nbsp;&nbsp;&nbsp;Then book the cheapest flight
                        </p>
                    </div>
                </div>
                <img class="img-fluid" src="assets/img/buil_bw.png" alt="" />
            </div>
        </section>
        <!-- Projects-->
        <section class="projects-section bg-light" id="projects">
            <div class="container" id="pMother">
                <!-- Featured Project Row-->
                <div class="row align-items-center no-gutters mb-4 mb-lg-5" id="info">
                    <div class="col-xl-8 col-lg-7"><img class="img-fluid mb-3 mb-lg-0" src="assets/img/graf.jpg" alt="" /></div>
                    <div class="col-xl-4 col-lg-5">
                        <div class="featured-text text-center text-lg-left">
                            <h4>Buy my head some space to clear</h4>
                            <p class="text-black-50 mb-0">It's no time to cut and run<br>But I can't think about what I've done</p>
                        </div>
                    </div>
                </div>
                <!-- Project One Row-->
                <div class="row justify-content-center no-gutters mb-5 mb-lg-0" id="p1">
                    <div class="col-lg-6"><img class="img-fluid" src="assets/img/bridge.jpg" alt="" /></div>
                    <div class="col-lg-6">
                        <div class="bg-black text-center h-100 project">
                            <div class="d-flex h-100">
                                <div class="project-text w-100 my-auto text-center text-lg-left" id ="bg1">
                                    <h4 class="text-white">To get me here</h4>
                                    <p id = "desc" class="mb-0 text-white-50">Two miles off the ground with no clouds to be seen<br>Give me some aire that's cold and clean<br>Love can't bring me down when I've taken myself<br>Way out of reach</p>
                                    <hr class="d-none d-lg-block mb-0 ml-0" />
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Project Two Row-->
                <div class="row justify-content-center no-gutters" id="p2">
                    <div class="col-lg-6"><img class="img-fluid" src="assets/img/money.jpg" alt="" /></div>
                    <div class="col-lg-6 order-lg-first">
                        <div class="bg-black text-center h-100 project">
                            <div class="d-flex h-100">
                                <div class="project-text w-100 my-auto text-center text-lg-right" id="bg2">
                                    <h4 class="text-white">Weakest move but fails</h4>
                                    <p id ="desc" class="mb-0 text-white-50">But you know this hope is on the side<br>Trying to split the change<br>into numbers that don't divide<br>I'll take one more sleepless night</p>
                                    <hr class="d-none d-lg-block mb-0 mr-0" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
        <Section>
            <div class="row align-items-center no-gutters mb-4 mb-lg-5">
                <div class="col-lg-8 mx-auto" id="player"></div>
                <div class="col-lg-8 mx-auto" id="player2"></div>
            </div>
        </Section>
            
        <!--게시판 시작-->
        <section>
            <div class="row align-items-center no-gutters mb-4 mb-lg-5">
                <div class="col-lg-8 mx-auto">
                    <table class="table">
                      <thead>
                        <tr>
                          <th scope="col">번호</th>
                          <th scope="col">글쓴이</th>
                          <th scope="col">내용</th>
                        </tr>
                      </thead>
                      <tbody id="tbody">
                      </tbody>
                    </table>
                     <!--페이징 시작-->
                    <nav aria-label="Page navigation example">
                        <p>총 글수 : <strong id="pagerTotal"></strong> </p>
                      <ul class="pagination justify-content-center" id="pagerReply">
                      </ul>
                    </nav>
                    <!--페이징 끝-->
                    <form id="replyForm">
                      <div class="form-group">
                        <label>내용</label>
                        <input type="text" class="form-control" id="content">
                      </div>
                      <div class="form-group">
                        <label>글쓴이</label>
                        <input type="text" class="form-control" id="writer">
                      </div>
                        <div class="form-group">
                        <label>패스워드</label>
                        <input type="password" class="form-control" id="password">
                      </div>
                      <input type="hidden" id="id">
                    </form>

                    <button class="btn btn-primary" id="replySubmit">제출</button>
                    <button class="btn btn-primary" id="replyUpdate">수정</button>
                    <button class="btn btn-primary" id="replyDelete">삭제</button>
                </div>
            </div>
        </section>
        <!--게시판 끝-->
        <!-- Signup-->
        <section class="signup-section" id="signup">
            <div class="container">
                <div class="row">
                    <div class="col-md-10 col-lg-8 mx-auto text-center">
                        <i class="far fa-paper-plane fa-2x mb-2 text-white"></i>
                        <h2 class="text-white mb-5">Subscribe to receive updates!</h2>
                        <form class="form-inline d-flex" id="subscribeForm">
                            <input class="form-control flex-fill mr-0 mr-sm-2 mb-3 mb-sm-0" id="inputEmail" type="email" placeholder="Enter email address..." />
                            <button class="btn btn-primary mx-auto" id="subscribe">Subscribe</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        <!-- Contact-->
        <section class="contact-section bg-black">
            <div class="container">
                <div class="row">
                    <div class="col-md-4 mb-3 mb-md-0">
                        <div class="card py-4 h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-map-marked-alt text-primary mb-2"></i>
                                <h4 class="text-uppercase m-0">Address</h4>
                                <hr class="my-4" />
                                <div class="small text-black-50">4923 Market Street, Orlando FL</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3 mb-md-0">
                        <div class="card py-4 h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-envelope text-primary mb-2"></i>
                                <h4 class="text-uppercase m-0">Email</h4>
                                <hr class="my-4" />
                                <div class="small text-black-50"><a href="#!">hello@yourdomain.com</a></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3 mb-md-0">
                        <div class="card py-4 h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-mobile-alt text-primary mb-2"></i>
                                <h4 class="text-uppercase m-0">Phone</h4>
                                <hr class="my-4" />
                                <div class="small text-black-50">+1 (555) 902-8832</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="social d-flex justify-content-center">
                    <a class="mx-2" href="#!"><i class="fab fa-twitter"></i></a>
                    <a class="mx-2" href="#!"><i class="fab fa-facebook-f"></i></a>
                    <a class="mx-2" href="#!"><i class="fab fa-github"></i></a>
                </div>
            </div>
        </section>
        <!-- Footer-->
        <footer class="footer bg-black small text-center text-white-50"><div class="container">Copyright © FEEL GOOD 2020</div></footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
        <!-- Third party plugin JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <script>
            setMagicButton();
            $("#magicButton").click(function(){
                setNoMagicButton();
                $("#header").addClass('masthead2').removeClass('masthead');
                $("#signup").addClass('signup-section2').removeClass('signup-section');
                $("#title1").empty().append("너에게로 가는 길");
                $("#desc1").empty().append("Slamdunk OST");
                $("#title2").empty().append("뜨거운 코트를 가르며 너에게 가고 있어");
                $("#desc2").empty().append("우리 함께한 맹세 위에 모든 걸 걸 수 있어<br>힘든 시간들이지만 난 웃을 수 있어<br>언제까지나 나를 믿고 사랑할 네가 있잖아");

                $("#about").find("img").attr("src", "assets/img/young.png");

                $.get("http://localhost:8080/info", function(data, status){
                $("#info").find("img").attr("src", "http://localhost:8080/"+data[0].imgLol);
                $("#info").find("h4").empty().append(data[0].titleLol);
                $("#info").find("p").empty().append(data[0].descLol);
                });

                $.get("http://localhost:8080/chara", function(data, status){
                for(var i = 0; i<data.length; i++){
                    if(i <2){
                    $("#p"+(i+1)).find("h4").empty().append(data[i].title+" "+data[i].engTitle);
                    $("#p"+(i+1)).find("h6").empty().append("("+data[i].nickname+" "+data[i].engNickname+")");
                    $("#p"+(i+1)).find("img").attr("src", "http://localhost:8080/"+data[i].img);
                    $("#p"+(i+1)).find("#desc").empty().append(data[i].desc);
                    }else{
                        if(i%2 == 0){
                            //p1 카피
                            $("#p1").clone().attr("id", "p"+(i+1)).appendTo("#pMother");
                            $("#p"+(i+1)).find("h4").empty().append(data[i].title+" "+data[i].engTitle);
                            $("#p"+(i+1)).find("h6").empty().append("("+data[i].nickname+" "+data[i].engNickname+")");
                            $("#p"+(i+1)).find("img").attr("src", "http://localhost:8080/"+data[i].img);
                            $("#p"+(i+1)).find("#desc").empty().append(data[i].desc);
                        }else{
                            //p2 카피
                            $("#p2").clone().attr("id", "p"+(i+1)).appendTo("#pMother");
                            $("#p"+(i+1)).find("h4").empty().append(data[i].title+" "+data[i].engTitle);
                            $("#p"+(i+1)).find("h6").empty().append("("+data[i].nickname+" "+data[i].engNickname+")");
                            $("#p"+(i+1)).find("img").attr("src", "http://localhost:8080/"+data[i].img);
                            $("#p"+(i+1)).find("#desc").empty().append(data[i].desc);
                            }
                        }
                    }
                });
            });

            //노 매직버튼을 눌렀을 때 다시 돌아가려면?
            $("#noMagicButton").click(function(){
                $(location).attr('href', 'index.html')
            });

            //Subscribe Create
            $("#subscribe").click(function(){
                       var formData = {
                        "inputEmail":$("#inputEmail").val()
                        };

                       $.ajax({
                        url:'http://localhost:8080/subscribe',
                        type:'post',
                        contentType: 'application/json',
                        data:JSON.stringify(formData),
                        success:function(data){
                        console.log("성공");
                        //폼을 리셋하고
                        $('#subscribeForm')[0].reset();
                        getEmail();
                    }
                })
            });

            function getEmail(){
                $.get("http://localhost:8080/subscribe", function(data, status){
                for(var i = 0 ; i < data.length ; i++){
                      $("#tbody2").append("<tr><td>"+data[i].inputEmail+"</td></tr>");        
                        }
                    });
            }
            
            getEmail();

            //create
            $("#replySubmit").click(function(){
                       var formData = {
                        "content":$("#content").val() , 
                        "writer":$("#writer").val(), 
                        "password":$("#password").val()
                        };

                       $.ajax({
                        url:'http://localhost:8080/reply',
                        type:'post',
                        contentType: 'application/json',
                        data:JSON.stringify(formData),
                        success:function(data){
                        console.log("성공");
                        //폼을 리셋하고
                        $('#replyForm')[0].reset();
                        //리플라이를 다시 불러오쟈
                        getReply();
                        setSubmitButton();
                    }
                })
            });

            //read
            function getReply(){
                $.get("http://localhost:8080/reply", function(data, status){
                    //기존 테이블 정보 삭제
                    $("#tbody").empty();
                    //데이터 삽입
                    for(var i = 0 ; i < data.replies.length ; i++){
                        //페이징 추가
                      $("#tbody").append('<tr><td><button onclick=setUpdateform('+data.replies[i].id+')>'+data.replies[i].id+'</button></td><td id=rw'+data.replies[i].id+'>'+data.replies[i].writer+'</td><td id=rc'+data.replies[i].id+'>'+data.replies[i].content+'</td></tr>');        
                        }

                //페이징 버튼 추가 #pagerReply
                $("#pagerTotal").empty().append(data.totalItems);
                //<li class="page-item"><a class="page-link" href="/reply?size=3%page=1">1</a></li>
                $("#pagerReply").empty();
                    for(var i = 0 ; i < data.totalPages ; i++){
                        if(data.currentPage != i){
                            $("#pagerReply").append('<li class="page-item"><button class="page-link" onclick=getReplyPage('+i+')>'+(i+1)+'</button></li>');
                        }else{
                             $("#pagerReply").append('<li class="page-item active"><button class="page-link" onclick=getReplyPage('+i+')>'+(i+1)+'</button></li>');
                        }
                    }
                });
            }

            //read with Page
            function getReplyPage(pageNumber){
                $.get("http://localhost:8080/reply?page="+pageNumber, function(data, status){
                    //기존 테이블 정보 삭제
                    $("#tbody").empty();
                    //데이터 삽입
                    for(var i = 0 ; i < data.replies.length ; i++){
                        //페이징 추가
                      $("#tbody").append('<tr><td><button onclick=setUpdateform('+data.replies[i].id+')>'+data.replies[i].id+'</button></td><td id=rw'+data.replies[i].id+'>'+data.replies[i].writer+'</td><td id=rc'+data.replies[i].id+'>'+data.replies[i].content+'</td></tr>');        
                        }

                //페이징 버튼 추가 #pagerReply
                $("#pagerTotal").empty().append(data.totalItems);
                //<li class="page-item"><a class="page-link" href="/reply?size=3%page=1">1</a></li>
                $("#pagerReply").empty();
                    for(var i = 0 ; i < data.totalPages ; i++){
                        if(data.currentPage != i){
                            $("#pagerReply").append('<li class="page-item"><button class="page-link" onclick=getReplyPage('+i+')>'+(i+1)+'</button></li>');
                        }else{
                             $("#pagerReply").append('<li class="page-item active"><button class="page-link" onclick=getReplyPage('+i+')>'+(i+1)+'</button></li>');
                        }
                    }
                });
            }

            //update
            $("#replyUpdate").click(function(){
                        //서버에 보낼 데이터 생성 
                       var formData = {
                        "content":$("#content").val() , 
                        "writer":$("#writer").val(), 
                        "password":$("#password").val()
                        };
                        //비동기 호출
                        //타입 GET / POST
                       $.ajax({
                        url:'http://localhost:8080/reply/'+$("#id").val(),
                        type:'put',
                        contentType: 'application/json',
                        data:JSON.stringify(formData),
                        //콜백
                        success:function(data){
                        console.log("수정성공");
                        //폼을 리셋하고
                        $('#replyForm')[0].reset();
                        //리플라이를 다시 불러오쟈
                        getReply();
                        setSubmitButton();
                        },
                        error: function (ajaxContext) {
                            alert("수정실패");
                            $('#replyForm')[0].reset();
                            getReply();
                        setSubmitButton();
                        }
                })
            });

             //delete
            $("#replyDelete").click(function(){
                        //서버에 보낼 데이터 생성 
                       var formData = {
                        "content":$("#content").val() , 
                        "writer":$("#writer").val(), 
                        "password":$("#password").val()
                        };
                        //비동기 호출
                        //타입 GET / POST
                       $.ajax({
                        url:'http://localhost:8080/reply/'+$("#id").val(),
                        type:'delete',
                        contentType: 'application/json',
                        data:JSON.stringify(formData),
                        //콜백
                        success:function(data){
                        console.log("삭제성공");
                        //폼을 리셋하고
                        $('#replyForm')[0].reset();
                        //리플라이를 다시 불러오쟈
                        getReply();
                        setSubmitButton();
                        },
                        error: function (ajaxContext) {
                            alert("삭제실패");
                             $('#replyForm')[0].reset();
                            getReply();
                        setSubmitButton();
                        }
                })
            });

            function setUpdateform(p1,p2,p3){
                console.log(p1+p2+p3);
                $("#id").val(p1);
                $("#writer").val(p2);
                $("#content").val(p3);
                setUpdateButton()
            }
                

            function setSubmitButton(){
             $("#replySubmit").show();
             $("#replyUpdate").hide();
             $("#replyDelete").hide();
            }
            

            function setUpdateButton(){
             $("#replySubmit").hide();
             $("#replyUpdate").show();
             $("#replyDelete").show();
            }

            function setMagicButton(){
             $("#magicButton").show();
             $("#noMagicButton").hide();
            }

            function setNoMagicButton(){
             $("#magicButton").hide();
             $("#noMagicButton").show();
            }

            //처음에 페이지가 실행 되었을때
            getReply();
            setSubmitButton();

        // 2. This code loads the IFrame Player API code asynchronously.
        var tag = document.createElement('script');

        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 3. This function creates an <iframe> (and YouTube player)
        //    after the API code downloads.
        var player;
        function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '360',
            width: '640',
            videoId: 'rqvA7T5FUTQ',
            events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
            }
        });
        }

        // 4. The API will call this function when the video player is ready.
        function onPlayerReady(event) {
        event.target.playVideo();
        }

        // 5. The API calls this function when the player's state changes.
        //    The function indicates that when playing a video (state=1),
        //    the player should play for six seconds and then stop.
        var done = false;
        function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING && !done) {
            setTimeout(stopVideo, 60000);
            done = true;
        }
        }
        function stopVideo() {
        player.stopVideo();
        }            
        </script>
    </body>
</html>
